<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ã‚«ãƒ¼ï¼ˆç°¡æ˜“ç‰ˆï¼‰ - å¿ƒç†æˆ¦ã‚«ã‚¸ãƒãƒ¢ãƒ¼ãƒ‰</title>
    <style>
        /* ======================== */
        /* ã‚«ã‚¸ãƒé¢¨CSSã¯ãƒ–ãƒ©ãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚¯ã‹ã‚‰æµç”¨ãƒ»èª¿æ•´ */
        /* ======================== */
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #0d230d;
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20" width="100%" height="20%"><path d="M10 20 H90 V10 Q50 0, 10 10 Z" fill="#8B0000"/><path d="M15 15 H85 V10 C80 5, 20 5, 15 10 Z" fill="#B22222"/></svg>') bottom center no-repeat,
                radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0) 60%),
                radial-gradient(ellipse at bottom left, #ccac00 0%, transparent 40%),
                radial-gradient(ellipse at top right, #ff9800 0%, transparent 40%),
                repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.05) 0px, rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 5px);
            background-size: auto 100px, cover, cover, cover, cover;
            background-attachment: fixed;
            color: #fff;
            padding: 20px;
        }

        .chandelier-light {
            position: fixed; top: 0; left: 0; width: 100%; height: 150px; pointer-events: none; overflow: hidden;
            background: radial-gradient(circle at 50% 10%, rgba(255, 255, 100, 0.4) 0%, rgba(255, 255, 150, 0) 60%);
            animation: twinkle 4s infinite alternate; z-index: 1; 
        }

        @keyframes twinkle {
            0% { opacity: 0.8; transform: scale(1, 1); }
            50% { opacity: 1; transform: scale(1.05, 1.1); }
            100% { opacity: 0.9; transform: scale(1, 1); }
        }

        .container {
            max-width: 900px; margin: 0 auto; background-color: rgba(0, 0, 0, 0.75); padding: 30px;
            border-radius: 15px; box-shadow: 0 8px 30px rgba(255, 215, 0, 0.3); 
            border: 5px solid #ccac00; position: relative; z-index: 10;
        }
        
        #infoBar {
            display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; 
            background-color: #0b4920; border-radius: 8px; margin-bottom: 20px; font-size: 1.1em; font-weight: bold;
        }
        .chip-icon { color: gold; margin-right: 5px; font-size: 1.2em; }
        .pot-icon { color: #ff4500; margin-right: 5px; font-size: 1.2em; }

        /* ãƒ™ãƒƒãƒˆ/é›£æ˜“åº¦é¸æŠã‚¨ãƒªã‚¢ */
        #preGameControls {
            margin-bottom: 20px; padding: 15px; background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px; display: flex; justify-content: center; align-items: center; gap: 25px;
        }
        
        select { padding: 10px; border-radius: 5px; font-size: 1.1em; background-color: #fff; color: #333; border: 1px solid #ccc; }
        
        /* ãƒ™ãƒƒãƒˆé¡å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ */
        input[type="number"] {
            padding: 10px 15px; border-radius: 5px; font-size: 1.5em; width: 80px; height: 50px; 
            background-color: #fff; color: #333; border: 3px solid #ccac00; text-align: center; font-weight: bold;
        }

        /* ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .hand { margin-bottom: 10px; padding: 15px; border-radius: 8px; }
        #communityArea { border: 2px dashed #993399; padding: 15px; margin: 20px 0; }
        
        .cards { display: flex; justify-content: center; margin: 10px 0; min-height: 100px; flex-wrap: wrap; }
        
        .card { 
            background-color: #fff; color: #000; border: 1px solid #000; border-radius: 5px;
            width: 70px; height: 90px; display: flex; flex-direction: column; justify-content: space-between;
            align-items: center; margin: 0 5px; padding: 5px; font-size: 1.2em;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); font-weight: bold;
        }
        .card.hidden { background-color: #8b0000; color: #fff; font-size: 1em; display: flex; justify-content: center; align-items: center; font-style: italic; }
        
        /* ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        button { padding: 10px 20px; font-size: 1em; margin: 5px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        #dealButton { background-color: #2196f3; color: #fff; }
        #foldButton { background-color: #8b0000; color: #fff; } /* é™ã‚Šã‚‹ */
        #callButton { background-color: #ff9800; color: #fff; } /* å‹è² ã«ä¹—ã‚‹ */
        #raiseButton { background-color: #4caf50; color: #fff; } /* è³­ã‘å¢—ã— */
        #checkButton { background-color: #607d8b; color: #fff; } /* ãƒã‚§ãƒƒã‚¯ */

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã¨ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼AA */
        #message { font-size: 1.5em; margin-top: 20px; font-weight: bold; background-color: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px; }
        .dealer-aa { font-size: 2.0em; margin-bottom: 5px; display: block; }

        /* ãƒãƒ¼ã‚«ãƒ¼å°‚ç”¨ã®è¿½åŠ è¡¨ç¤º */
        #currentBetStatus { margin: 10px 0; font-weight: bold; }
        .hand-status { color: #ccac00; font-weight: bold; margin-top: 5px; }
    </style>
</head>
<body>

<div class="chandelier-light"></div>

<div class="container">
    <h1>POKER (Texas Hold'em Style)</h1>
    
    <div id="infoBar">
        <div class="info-item">
            <span class="chip-icon">ğŸ’°</span> ã‚ãªãŸã®ãƒãƒƒãƒ—: <span id="chipsAmount">1000</span>
        </div>
        <div class="info-item">
            <span class="pot-icon">ğŸ”¥</span> ãƒãƒƒãƒˆç·é¡: <span id="potAmount">0</span>
        </div>
    </div>

    <div id="dealerHand" class="hand">
        <h2>ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®æ‰‹æœ­: <span id="dealerHandStatus" class="hand-status">?</span></h2>
        <div id="dealerCards" class="cards"></div>
    </div>
    
    <div id="communityArea">
        <h3>å ´æœ­ (ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰)</h3>
        <div id="communityCards" class="cards"></div>
    </div>

    <div id="playerHand" class="hand">
        <h2>ã‚ãªãŸã®æ‰‹æœ­: <span id="playerHandStatus" class="hand-status">?</span></h2>
        <div id="playerCards" class="cards"></div>
    </div>

    <div id="preGameControls">
        <div>
            <label for="anteAmount">ã‚¢ãƒ³ãƒ†ã‚£ (å‚åŠ æ–™):</label>
            <input type="number" id="anteAmount" value="10" min="10" step="10">
        </div>
        <div>
            <label for="raiseAmount">ãƒ¬ã‚¤ã‚ºé¡:</label>
            <input type="number" id="raiseAmount" value="20" min="10" step="10">
        </div>
    </div>

    <div id="currentBetStatus">
        ç¾åœ¨ã®ãƒ™ãƒƒãƒˆçŠ¶æ³ï¼šãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ <span id="dealerCurrentBet">0</span> / ã‚ãªãŸ <span id="playerCurrentBet">0</span>
    </div>

    <div id="buttons">
        <button id="dealButton">ã‚²ãƒ¼ãƒ é–‹å§‹ (ã‚¢ãƒ³ãƒ†ã‚£ã‚’è³­ã‘ã‚‹)</button>
        <div id="actionButtons" style="display: none;">
            <button id="foldButton" disabled>ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</button>
            <button id="checkCallButton" disabled>ãƒã‚§ãƒƒã‚¯ / ã‚³ãƒ¼ãƒ«</button>
            <button id="raiseButton" disabled>ãƒ¬ã‚¤ã‚º (è³­ã‘å¢—ã—)</button>
        </div>
    </div>
    
    <div id="message">
        <div class="dealer-aa">(*^.^*)</div> ã‚¢ãƒ³ãƒ†ã‚£ã‚’æ±ºã‚ã¦ã€ã‚²ãƒ¼ãƒ é–‹å§‹ã‚ˆï¼
    </div>
    
    <div id="postGameButtons" style="display: none; margin-top: 20px;">
        <button id="nextGameButton">æ¬¡ã®å‹è² ã¸</button>
    </div>
</div>

<script>
    // ----------------------------------------------------
    //  ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã¨å®šæ•°
    // ----------------------------------------------------
    const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const VALUES = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A']; // T=10
    const VALUE_MAP = {'2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, 'T': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14};
    const HAND_RANKINGS = [
        'ãƒã‚¤ã‚«ãƒ¼ãƒ‰', 'ãƒ¯ãƒ³ãƒšã‚¢', 'ãƒ„ãƒ¼ãƒšã‚¢', 'ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰', 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ', 
        'ãƒ•ãƒ©ãƒƒã‚·ãƒ¥', 'ãƒ•ãƒ«ãƒã‚¦ã‚¹', 'ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰', 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', 'ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥'
    ];

    // HTMLè¦ç´ 
    const chipsAmountEl = document.getElementById('chipsAmount');
    const potAmountEl = document.getElementById('potAmount');
    const dealerCardsEl = document.getElementById('dealerCards');
    const playerCardsEl = document.getElementById('playerCards');
    const communityCardsEl = document.getElementById('communityCards');
    const messageEl = document.getElementById('message');
    const dealButton = document.getElementById('dealButton');
    const actionButtons = document.getElementById('actionButtons');
    const foldButton = document.getElementById('foldButton');
    const checkCallButton = document.getElementById('checkCallButton');
    const raiseButton = document.getElementById('raiseButton');
    const anteAmountInput = document.getElementById('anteAmount');
    const raiseAmountInput = document.getElementById('raiseAmount');
    const dealerCurrentBetEl = document.getElementById('dealerCurrentBet');
    const playerCurrentBetEl = document.getElementById('playerCurrentBet');
    const dealerHandStatusEl = document.getElementById('dealerHandStatus');
    const playerHandStatusEl = document.getElementById('playerHandStatus');
    const postGameButtons = document.getElementById('postGameButtons');
    
    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let chips = 1000;
    let pot = 0;
    let deck = [];
    let dealerHand = []; // 2æš
    let playerHand = []; // 2æš
    let communityCards = []; // æœ€å¤§5æš
    let dealerBet = 0;
    let playerBet = 0;
    let currentBettingRound = 0; // 0: Pre-flop, 1: Flop, 2: Turn, 3: River
    let isGameOver = true;
    let isPlayerTurn = true;
    let lastRaiser = null; // æœ€å¾Œã«ãƒ¬ã‚¤ã‚ºã—ãŸäºº ('player' or 'dealer')

    // ----------------------------------------------------
    //  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° (ãƒ–ãƒ©ãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚¯ã‹ã‚‰ç¶™æ‰¿/èª¿æ•´)
    // ----------------------------------------------------

    function getDealerMessage(type, amount = 0, handName = '') {
        // AAã¨ã‚»ãƒªãƒ•ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒãƒ¼ã‚«ãƒ¼ç”¨ã«èª¿æ•´
        let aa = '';
        let message = '';
        const potMsg = `ãƒãƒƒãƒˆç·é¡ã¯ ${pot} ã‚ˆã€‚`;

        switch (type) {
            case 'start':
                aa = '(*^.^*)';
                message = `ã‚¢ãƒ³ãƒ†ã‚£ã‚’æ±ºã‚ã¦ã€ã‚²ãƒ¼ãƒ é–‹å§‹ã‚ˆï¼`;
                break;
            case 'ante':
                aa = '(^_^)';
                message = `ã‚¢ãƒ³ãƒ†ã‚£ ${amount} ãŒè³­ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚ã•ã‚ã€å‹è² ã‚ˆï¼`;
                break;
            case 'flop':
                aa = '(Â°Ï‰Â°)';
                message = `ãƒ•ãƒ­ãƒƒãƒ—ï¼3æšã®ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚ŒãŸã‚ã€‚`;
                break;
            case 'turn':
                aa = '(-Ï‰-)';
                message = `ã‚¿ãƒ¼ãƒ³ï¼4æšç›®ã®ã‚«ãƒ¼ãƒ‰ã‚ˆã€‚`;
                break;
            case 'river':
                aa = '(ãƒ¡_ãƒ¡)';
                message = `ãƒªãƒãƒ¼ï¼æœ€çµ‚ã‚«ãƒ¼ãƒ‰ã‚ˆã€‚`;
                break;
            case 'dealer_bet':
                aa = '(^-^)/';
                message = `ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒ ${amount} ãƒ™ãƒƒãƒˆã€‚ã‚ãªãŸã®ç•ªã‚ˆã€‚` + potMsg;
                break;
            case 'dealer_call':
                aa = '(-_-)';
                message = `ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã¯ã‚³ãƒ¼ãƒ«ã€‚æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã‘ã‚‹ã‚ã€‚` + potMsg;
                break;
            case 'dealer_raise':
                aa = 'o(^-^)o';
                message = `ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒ ${amount} ã«ãƒ¬ã‚¤ã‚ºã€‚ã©ã†ã™ã‚‹ï¼Ÿ` + potMsg;
                break;
            case 'dealer_check':
                aa = '(^_^)';
                message = `ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã¯ãƒã‚§ãƒƒã‚¯ã€‚` + potMsg;
                break;
            case 'player_win':
                aa = '(^O^)/';
                message = `ğŸ‰ **ã‚ãªãŸã®å¤§å‹åˆ©ï¼** ${handName} ãŒå®Œæˆã‚ˆã€‚ãƒãƒƒãƒˆ ${amount} ã‚’ç²å¾—ï¼`;
                break;
            case 'dealer_win':
                aa = '(-_ãƒ¡)';
                message = `ğŸ’” **ãƒ«ãƒ¼ã‚ºãƒ»ãƒ¦ã‚¢ãƒ»ãƒ™ãƒƒãƒˆã€‚** ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã® ${handName} ã«è² ã‘ãŸã‚ã€‚`;
                break;
            case 'push':
                aa = '(-_-)';
                message = `ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆå¼•ãåˆ†ã‘ï¼‰ã€‚ãƒãƒƒãƒˆ ${amount} ã‚’åˆ†ã‘åˆã†ã‚ã€‚`;
                break;
            case 'player_fold':
                aa = 'ãƒ»_ãƒ»';
                message = `ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã­ã€‚ãƒãƒƒãƒˆ ${amount} ã¯ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚‚ã®ã‚ˆã€‚`;
                break;
            default:
                aa = '^_^;';
                message = 'æ¬¡ã®å‹è² ã¸ã©ã†ãã€‚';
        }
        
        return `<div class="dealer-aa">${aa}</div>${message}`;
    }


    function updateDisplay() {
        chipsAmountEl.textContent = chips;
        potAmountEl.textContent = pot;
        dealerCurrentBetEl.textContent = dealerBet;
        playerCurrentBetEl.textContent = playerBet;
        anteAmountInput.max = chips;
        raiseAmountInput.max = chips;
    }

    function createAndShuffleDeck() {
        // Deckã®ä½œæˆã¨ã‚·ãƒ£ãƒƒãƒ•ãƒ« (Blackjackã¨å…±é€š)
        deck = [];
        for (let suit of SUITS) {
            for (let value of VALUES) {
                deck.push({ suit, value });
            }
        }
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    function drawCard() {
        return deck.pop();
    }

    function getCardHtml(card, isHidden = false) {
        // ã‚«ãƒ¼ãƒ‰HTMLã®æç”» (Blackjackã¨å…±é€š)
        if (isHidden) {
            return `<div class="card hidden">POKER<br>CARD</div>`;
        }
        const color = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : 'black';
        return `
            <div class="card" style="color: ${color};">
                <div class="card-value">${card.value}</div>
                <div class="card-suit" style="font-size: 1.5em;">${card.suit}</div>
                <div class="card-value">${card.value}</div>
            </div>
        `;
    }

    function renderHands(showDealer = false) {
        // ã‚«ãƒ¼ãƒ‰ã®æç”»ãƒ­ã‚¸ãƒƒã‚¯
        dealerCardsEl.innerHTML = dealerHand.map(card => 
            getCardHtml(card, !showDealer)
        ).join('');
        
        playerCardsEl.innerHTML = playerHand.map(card => 
            getCardHtml(card)
        ).join('');
        
        communityCardsEl.innerHTML = communityCards.map(card => 
            getCardHtml(card)
        ).join('');

        // å½¹ã®è¡¨ç¤ºã¯ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ï¼ˆshowDealer=trueï¼‰ã®æ™‚ã®ã¿
        if (showDealer) {
             const playerResult = evaluateHand([...playerHand, ...communityCards]);
             const dealerResult = evaluateHand([...dealerHand, ...communityCards]);
             playerHandStatusEl.textContent = playerResult.name;
             dealerHandStatusEl.textContent = dealerResult.name;
        } else {
             playerHandStatusEl.textContent = '?';
             dealerHandStatusEl.textContent = '?';
        }
    }

    // ----------------------------------------------------
    //  ãƒãƒ¼ã‚«ãƒ¼å½¹ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (æœ€ã‚‚é‡è¦ãªéƒ¨åˆ†)
    // ----------------------------------------------------

    function evaluateHand(cards) {
        // 7æšã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰æœ€ã‚‚å¼·ã„5æšã®å½¹ã‚’è¦‹ã¤ã‘ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ (éå¸¸ã«è¤‡é›‘ãªãŸã‚ã€ã“ã“ã¯å¾Œã§è©³ç´°ã«ä½œã‚Šè¾¼ã¿ã¾ã™)
        // ä»Šå›ã¯ç°¡ç•¥åŒ–ã—ã€7æšã‹ã‚‰å½¹ã‚’åˆ¤å®šã™ã‚‹ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€æ—¦è¨˜è¿°ã—ã¾ã™ã€‚
        
        if (cards.length < 5) return { rank: 0, name: 'ã‚«ãƒ¼ãƒ‰ä¸è¶³' };

        // ç°¡æ˜“å½¹åˆ¤å®šï¼ˆã“ã“ã§ã¯ä¸€æ—¦ã€å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰å½¹ã‚’åˆ¤å®šã™ã‚‹ç°¡æ˜“ç‰ˆï¼‰
        const valuesCount = cards.reduce((acc, card) => {
            acc[card.value] = (acc[card.value] || 0) + 1;
            return acc;
        }, {});
        
        const suitsCount = cards.reduce((acc, card) => {
            acc[card.suit] = (acc[card.suit] || 0) + 1;
            return acc;
        }, {});

        let rank = 0; // åˆæœŸå€¤: ãƒã‚¤ã‚«ãƒ¼ãƒ‰

        // ãƒ¯ãƒ³ãƒšã‚¢ã€ãƒ„ãƒ¼ãƒšã‚¢ã€ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã€ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰ã®åˆ¤å®š
        let pairs = 0;
        let triples = 0;
        let quads = 0;

        for (const count of Object.values(valuesCount)) {
            if (count === 2) pairs++;
            if (count === 3) triples++;
            if (count === 4) quads++;
        }

        if (quads > 0) {
            rank = 7; // ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰
        } else if (triples > 0 && pairs > 0) {
            rank = 6; // ãƒ•ãƒ«ãƒã‚¦ã‚¹
        } else if (triples > 0) {
            rank = 3; // ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰
        } else if (pairs >= 2) {
            rank = 2; // ãƒ„ãƒ¼ãƒšã‚¢
        } else if (pairs === 1) {
            rank = 1; // ãƒ¯ãƒ³ãƒšã‚¢
        }

        // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã®åˆ¤å®š
        let isFlush = Object.values(suitsCount).some(count => count >= 5);
        if (isFlush) {
            rank = Math.max(rank, 5);
        }

        // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã®åˆ¤å®š
        let numValues = Object.keys(VALUE_MAP).map(v => VALUE_MAP[v]).sort((a, b) => a - b);
        let uniqueValues = [...new Set(cards.map(card => VALUE_MAP[card.value]))].sort((a, b) => a - b);
        
        // A, 2, 3, 4, 5 ã®ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ (ãƒ›ã‚¤ãƒ¼ãƒ«) ã®ãŸã‚ã« 1 (ã‚¨ãƒ¼ã‚¹ã‚’1ã¨ã—ã¦) ã‚’è¿½åŠ 
        if (uniqueValues.includes(14)) uniqueValues.unshift(1); 

        let isStraight = false;
        if (uniqueValues.length >= 5) {
            for (let i = 0; i <= uniqueValues.length - 5; i++) {
                if (uniqueValues[i+4] === uniqueValues[i] + 4) {
                    isStraight = true;
                    break;
                }
            }
        }
        if (isStraight) {
            rank = Math.max(rank, 4);
        }
        
        // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã€ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã®åˆ¤å®š (è¤‡é›‘ãªãŸã‚ã€ã“ã“ã§ã¯ä¸€æ—¦ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã¨ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãŒä¸¡ç«‹ã™ã‚Œã°OKã¨ã™ã‚‹)
        if (isStraight && isFlush) {
             // 5æšã®æœ€å¼·ã®çµ„ã¿åˆã‚ã›ã‚’ç‰¹å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã ãŒã€ç°¡æ˜“ç‰ˆã§ã¯ä¸€æ—¦ 8 or 9 ã¨ã™ã‚‹
             rank = 8; 
             // ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã®åˆ¤å®šã‚‚ã“ã“ã§ã¯çœç•¥
        }
        
        // â˜…æ³¨æ„: ã“ã®ç°¡æ˜“åˆ¤å®šã§ã¯ã€è¤‡æ•°ã®å½¹ãŒå¯èƒ½ãª7æšã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã€Œæœ€ã‚‚å¼·ã„5æšã€ã‚’é¸ã¶ã¨ã„ã†ãƒãƒ¼ã‚«ãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å³å¯†ã«å†ç¾ã§ãã¦ã„ã¾ã›ã‚“ã€‚
        // ã—ã‹ã—ã€ã‚²ãƒ¼ãƒ ã®ãƒ†ã‚¹ãƒˆã¨é€²è¡Œã®ãŸã‚ã«ã€ä¸€æ—¦ã“ã®ç°¡ç•¥ç‰ˆã§é€²ã‚ã¾ã™ã€‚æœ€çµ‚çš„ã«å®Œå…¨ãªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚

        return { rank: rank, name: HAND_RANKINGS[rank] };
    }

    // ----------------------------------------------------
    //  ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼é–¢æ•°
    // ----------------------------------------------------
    
    function resetGame() {
        deck = [];
        dealerHand = [];
        playerHand = [];
        communityCards = [];
        pot = 0;
        dealerBet = 0;
        playerBet = 0;
        currentBettingRound = 0;
        isGameOver = true;
        lastRaiser = null;
        
        renderHands(false);
        updateDisplay();

        dealerHandStatusEl.textContent = '?';
        playerHandStatusEl.textContent = '?';
        
        dealButton.style.display = 'block';
        actionButtons.style.display = 'none';
        postGameButtons.style.display = 'none';
        messageEl.innerHTML = getDealerMessage('start');
    }

    function startGame() {
        if (chips < parseInt(anteAmountInput.value)) {
            messageEl.innerHTML = getDealerMessage('start') + 'ãƒãƒƒãƒ—ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚';
            return;
        }

        isGameOver = false;
        createAndShuffleDeck();
        
        // ã‚¢ãƒ³ãƒ†ã‚£ã®å‡¦ç†
        const ante = parseInt(anteAmountInput.value);
        chips -= ante;
        pot += ante;
        playerBet = ante;
        dealerBet = ante; // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚¢ãƒ³ãƒ†ã‚£ã¯potã«å«ã‚ã‚‹ã ã‘ã§ãƒãƒƒãƒ—æ®‹é«˜ã¯æ¸›ã‚‰ã•ãªã„ï¼ˆAIã®ãŸã‚ï¼‰
        
        // ã‚«ãƒ¼ãƒ‰ã®é…å¸ƒ (æ‰‹æœ­2æšãšã¤)
        playerHand.push(drawCard(), drawCard());
        dealerHand.push(drawCard(), drawCard());

        renderHands(false);
        updateDisplay();

        messageEl.innerHTML = getDealerMessage('ante', ante);

        // æœ€åˆã®ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ (ãƒ•ãƒ­ãƒƒãƒ—å‰)
        currentBettingRound = 0;
        lastRaiser = 'dealer'; // æœ€åˆã®ãƒ™ãƒƒãƒˆã¯ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼å´ã‹ã‚‰å§‹ã¾ã‚‹ï¼ˆãƒãƒ¼ã‚«ãƒ¼ã®ãƒ«ãƒ¼ãƒ«ï¼‰
        playerActionPhase();
    }
    
    function dealerAction() {
        // ç°¡æ˜“AIãƒ­ã‚¸ãƒƒã‚¯
        
        // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ç°¡æ˜“è©•ä¾¡ (æ‰‹æœ­2æšã®ã¿)
        const dealerRank = evaluateHand(dealerHand).rank;
        const requiredCall = dealerBet - playerBet;
        const currentPot = pot;
        let action = 'check';
        let raiseAmount = 0;

        // å½¹ãŒã§ãã¦ã„ãªã„å ´åˆã€å¼·æ°—ãªãƒ™ãƒƒãƒˆã«ã¯ã‚³ãƒ¼ãƒ«ã—ãªã„
        if (dealerRank <= 1 && playerBet > dealerBet && requiredCall > pot * 0.1) {
            action = 'fold';
        } 
        // å½¹ãŒã§ãã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ¼ãƒ«/ãƒ¬ã‚¤ã‚ºã‚’æ¤œè¨
        else if (dealerRank >= 2 || (dealerRank === 1 && VALUE_MAP[dealerHand[0].value] >= 10 && VALUE_MAP[dealerHand[1].value] >= 10)) {
            // ãƒšã‚¢ãŒã§ãã¦ã„ã‚‹ã€ã¾ãŸã¯é«˜ã„ã‚«ãƒ¼ãƒ‰ï¼ˆT, J, Q, K, Aï¼‰ã‚’æŒã£ã¦ã„ã‚‹å ´åˆ
            if (requiredCall > 0) {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ¬ã‚¤ã‚ºã—ãŸå ´åˆã€ã‚³ãƒ¼ãƒ«
                action = 'call';
            } else if (Math.random() < 0.25) {
                // èª°ã‚‚è³­ã‘ã¦ã„ãªã„å ´åˆã€25%ã®ç¢ºç‡ã§ãƒ™ãƒƒãƒˆ
                action = 'bet';
                raiseAmount = Math.max(playerBet * 2, 20); // æœ€å°20ãƒãƒƒãƒ—
            }
        } 
        
        // æœ€çµ‚çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        if (action === 'fold') {
            endGame('dealer_fold');
        } else if (action === 'call') {
            pot += requiredCall;
            dealerBet += requiredCall;
            messageEl.innerHTML = getDealerMessage('dealer_call');
            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã®ã§ã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
            setTimeout(nextPhase, 1000); 
        } else if (action === 'bet' || action === 'raise') {
            const betAmount = raiseAmount;
            pot += betAmount;
            dealerBet += betAmount;
            messageEl.innerHTML = getDealerMessage('dealer_raise', betAmount);
            lastRaiser = 'dealer';
            playerActionPhase(); // å†åº¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç•ª
        } else { // Check
            messageEl.innerHTML = getDealerMessage('dealer_check');
            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã®ã§ã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
            setTimeout(nextPhase, 1000); 
        }
        
        updateDisplay();
    }

    function playerActionPhase() {
        // ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
        dealButton.style.display = 'none';
        postGameButtons.style.display = 'none';
        actionButtons.style.display = 'block';
        
        const requiredCall = dealerBet - playerBet;
        const isDealerBetting = dealerBet > 0;
        
        foldButton.disabled = false;
        raiseButton.disabled = false;
        
        if (requiredCall > 0) {
            // ã‚³ãƒ¼ãƒ«ãŒå¿…è¦
            checkCallButton.textContent = `ã‚³ãƒ¼ãƒ« (${requiredCall})`;
            checkCallButton.disabled = chips < requiredCall;
        } else {
            // ãƒã‚§ãƒƒã‚¯å¯èƒ½
            checkCallButton.textContent = 'ãƒã‚§ãƒƒã‚¯';
            checkCallButton.disabled = false;
        }
        
        // ãƒ¬ã‚¤ã‚ºé¡ã®æœ€å°å€¤åˆ¶å¾¡
        raiseAmountInput.min = Math.max(requiredCall + 10, 10);
    }

    function handlePlayerAction(type) {
        if (isGameOver) return;
        
        const requiredCall = dealerBet - playerBet;
        const raiseAmount = parseInt(raiseAmountInput.value);
        
        if (type === 'fold') {
            endGame('player_fold');
            return;
        } 
        
        // ã‚³ãƒ¼ãƒ«/ãƒã‚§ãƒƒã‚¯
        if (type === 'call_check') {
            if (requiredCall > 0) { // ã‚³ãƒ¼ãƒ«
                if (chips < requiredCall) return;
                chips -= requiredCall;
                pot += requiredCall;
                playerBet += requiredCall;
                
                // ã‚³ãƒ¼ãƒ«å¾Œã¯ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã¨è¦‹ãªã—ã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
                messageEl.innerHTML = getDealerMessage('default', 0, 'ã‚ãªãŸã¯ã‚³ãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚');
                setTimeout(nextPhase, 1000);
            } else { // ãƒã‚§ãƒƒã‚¯
                // ãƒã‚§ãƒƒã‚¯å¾Œã¯ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ç§»è¡Œ
                messageEl.innerHTML = getDealerMessage('default', 0, 'ã‚ãªãŸã¯ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸã€‚');
                dealerAction();
                return;
            }
        }
        
        // ãƒ¬ã‚¤ã‚º
        if (type === 'raise') {
            if (raiseAmount <= requiredCall || chips < raiseAmount) return;

            const totalRaise = raiseAmount; // ãƒ¬ã‚¤ã‚¶ãƒ¼ã®ç·ãƒ™ãƒƒãƒˆé¡
            const toBet = totalRaise - playerBet; // ãƒãƒƒãƒˆã«å…¥ã‚Œã‚‹è¿½åŠ ãƒãƒƒãƒ—
            
            chips -= toBet;
            pot += toBet;
            playerBet = totalRaise; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·ãƒ™ãƒƒãƒˆé¡ã‚’æ›´æ–°
            
            messageEl.innerHTML = getDealerMessage('default', 0, `ã‚ãªãŸã¯ ${totalRaise} ã«ãƒ¬ã‚¤ã‚ºã—ã¾ã—ãŸã€‚`);
            lastRaiser = 'player';
            // ãƒ¬ã‚¤ã‚ºå¾Œã¯ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ç§»è¡Œ
            dealerAction();
            return;
        }

        updateDisplay();
    }
    
    function nextPhase() {
        if (isGameOver) return;
        
        // ãƒ™ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        pot += dealerBet; 
        pot += playerBet; 
        dealerBet = 0;
        playerBet = 0;
        
        currentBettingRound++;
        
        if (currentBettingRound === 1) {
            // ãƒ•ãƒ­ãƒƒãƒ— (3æš)
            communityCards.push(drawCard(), drawCard(), drawCard());
            messageEl.innerHTML = getDealerMessage('flop');
        } else if (currentBettingRound === 2) {
            // ã‚¿ãƒ¼ãƒ³ (4æšç›®)
            communityCards.push(drawCard());
            messageEl.innerHTML = getDealerMessage('turn');
        } else if (currentBettingRound === 3) {
            // ãƒªãƒãƒ¼ (5æšç›®)
            communityCards.push(drawCard());
            messageEl.innerHTML = getDealerMessage('river');
        } else if (currentBettingRound >= 4) {
            // ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ã¸
            showdown();
            return;
        }

        renderHands(false);
        updateDisplay();
        
        // æ¬¡ã®ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ (ãƒã‚§ãƒƒã‚¯ã‹ã‚‰)
        playerActionPhase(); 
        checkCallButton.textContent = 'ãƒã‚§ãƒƒã‚¯';
    }

    function showdown() {
        isGameOver = true;
        renderHands(true); 

        const playerResult = evaluateHand([...playerHand, ...communityCards]);
        const dealerResult = evaluateHand([...dealerHand, ...communityCards]);
        
        let winner = 'none';
        
        if (playerResult.rank > dealerResult.rank) {
            winner = 'player';
        } else if (playerResult.rank < dealerResult.rank) {
            winner = 'dealer';
        } else {
            // åŒä¸€ãƒ©ãƒ³ã‚¯ã®å ´åˆã®ã‚­ãƒƒã‚«ãƒ¼åˆ¤å®šï¼ˆç°¡æ˜“ç‰ˆã§ã¯çœç•¥ã—ã€å¼•ãåˆ†ã‘ã¨ã—ã¾ã™ï¼‰
            winner = 'push'; 
        }

        if (winner === 'player') {
            chips += pot;
            messageEl.innerHTML = getDealerMessage('player_win', pot, playerResult.name);
        } else if (winner === 'dealer') {
            messageEl.innerHTML = getDealerMessage('dealer_win', 0, dealerResult.name);
        } else {
            chips += Math.floor(pot / 2);
            messageEl.innerHTML = getDealerMessage('push', pot);
        }

        updateDisplay();
        dealButton.style.display = 'none';
        actionButtons.style.display = 'none';
        postGameButtons.style.display = 'block';
    }

    function endGame(reason) {
        isGameOver = true;
        let finalPot = pot + dealerBet + playerBet;

        if (reason === 'player_fold') {
            messageEl.innerHTML = getDealerMessage('player_fold', finalPot);
        } else if (reason === 'dealer_fold') {
            chips += finalPot;
            messageEl.innerHTML = getDealerMessage('player_win', finalPot, 'ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒé™ã‚Šã¾ã—ãŸï¼');
        }
        
        pot = 0; // ãƒãƒƒãƒˆã¯å‹è€…ãŒç·å–ã‚Šã—ãŸã®ã§ãƒªã‚»ãƒƒãƒˆ
        updateDisplay();
        dealButton.style.display = 'none';
        actionButtons.style.display = 'none';
        postGameButtons.style.display = 'block';
    }


    // ----------------------------------------------------
    //  ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    // ----------------------------------------------------
    dealButton.addEventListener('click', startGame);
    document.getElementById('nextGameButton').addEventListener('click', resetGame);
    
    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
    foldButton.addEventListener('click', () => handlePlayerAction('fold'));
    checkCallButton.addEventListener('click', () => handlePlayerAction('call_check'));
    raiseButton.addEventListener('click', () => handlePlayerAction('raise'));

    // åˆæœŸåŒ–
    resetGame();
</script>
</body>
</html>
